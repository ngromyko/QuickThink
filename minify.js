const mainButtonName="AI Replies",generalColor="#2cb52c";var locationPathName="";function checkTrigger(){let e=getMessages();locationPathName!==window.location.pathname&&e.length>0&&(locationPathName=window.location.pathname,handle(e)),requestAnimationFrame(checkTrigger)}function getMessages(){return Array.from(document.querySelectorAll(".msg-s-event-listitem__body")).map(e=>e.textContent)}function handle(e){let t=e.slice(-1).toString().replace(/\s+/g," ");if(t){document.getElementById("ul-answers")?.remove();let n=document.querySelector(".msg-form__right-actions");document.getElementById("IdRetrieveLastMessage")?.remove();let r=createReplyButton();r.addEventListener("click",async e=>{e.preventDefault(),r.textContent="Loading";try{await generateAnswers(t),r.textContent=REPLY_BUTTON_NAME}catch(n){r.textContent="Try Again"}}),document.querySelector(".msg-form__send-button").addEventListener("click",async e=>{document.getElementById("ul-answers")?.remove()}),n.prepend(r)}}async function generateAnswers(e){try{let t="text-davinci-003";await chrome.storage.local.get(["selectedOption"]).then(e=>{"quickReplies"===e.selectedOption&&(t="text-curie-001")});let n=await globalThis.generateResponse(e,180,2,t);n=[...new Set(n)],document.getElementById("ul-answers")?.remove();let r=createUl(n),o=document.querySelector(".msg-s-message-list-container");o.appendChild(r),document.querySelector(".conversations-quick-replies")?.remove(),document.querySelector(".msg-s-message-list__quick-replies-container")?.remove()}catch(a){throw console.error(a),a}}function createUl(e){let t=document.createElement("ul");return t.id="ul-answers",t.style.marginBottom="5px",t.style.marginTop="5px",e.forEach(e=>{let n=document.createElement("li");n.style.margin="8px";let r=createAnswerButton(e),o=document.createElement("span");o.innerHTML=e.trunc(150),r.appendChild(o),n.appendChild(r),t.appendChild(n)}),t}function createAnswerButton(e){let t=document.createElement("button");return t.className="artdeco-button artdeco-button--secondary",t.style.color=GENERAL_COLOR,t.style.boxShadow="inset 0 0 0 1px "+GENERAL_COLOR,t.style.fontSize="unset",t.style.setProperty("padding-left","0.8rem","important"),t.style.setProperty("padding-right","0.8rem","important"),t.style.width="100%",t.addEventListener("click",()=>{document.querySelector(".msg-form__placeholder")?.remove(),document.querySelector(".msg-form__contenteditable p").textContent=e,document.querySelector(".msg-form__contenteditable").dispatchEvent(new InputEvent("input",{data:e,bubbles:!0})),document.querySelector(".msg-form__send-button").disabled=!1}),t}function createReplyButton(){let e=document.createElement("button");return e.id="IdRetrieveLastMessage",e.classList="artdeco-button artdeco-button--1",e.style.marginRight="5px",e.style.backgroundColor=GENERAL_COLOR,e.textContent=REPLY_BUTTON_NAME,e}checkTrigger(),String.prototype.trunc=function(e){return this.substr(0,e-1)+(this.length>e?"&hellip;":"")};